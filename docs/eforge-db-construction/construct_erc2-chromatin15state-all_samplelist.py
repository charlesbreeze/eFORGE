#!/usr/bin/env python

import sys 
import os

files_dir = "erc2-chromatin15state-all-files"

if not os.path.exists(files_dir):
  raise SystemError("Could not find files directory...\n")

marks = [ '1_TssA',
          '2_TssAFlnk',
          '3_TxFlnk',
          '4_Tx',
          '5_TxWk',
          '6_EnhG',
          '7_Enh',
          '8_ZNF-Rpts',
          '9_Het',
          '10_TssBiv',
          '11_BivFlnk',
          '12_EnhBiv',
          '13_ReprPC',
          '14_ReprPCWk',
          '15_Quies' ]

all = [ 'E001',
        'E002',
        'E003',
        'E004',
        'E005',
        'E006',
        'E007',
        'E008',
        'E009',
        'E010',
        'E011',
        'E012',
        'E013',
        'E014',
        'E015',
        'E016',
        'E017',
        'E018',
        'E019',
        'E020',
        'E021',
        'E022',
        'E023',
        'E024',
        'E025',
        'E026',
        'E027',
        'E028',
        'E029',
        'E030',
        'E031',
        'E032',
        'E033',
        'E034',
        'E035',
        'E036',
        'E037',
        'E038',
        'E039',
        'E040',
        'E041',
        'E042',
        'E043',
        'E044',
        'E045',
        'E046',
        'E047',
        'E048',
        'E049',
        'E050',
        'E051',
        'E052',
        'E053',
        'E054',
        'E055',
        'E056',
        'E057',
        'E058',
        'E059',
        'E061',
        'E062',
        'E063',
        'E065',
        'E066',
        'E067',
        'E068',
        'E069',
        'E070',
        'E071',
        'E072',
        'E073',
        'E074',
        'E075',
        'E076',
        'E077',
        'E078',
        'E079',
        'E080',
        'E081',
        'E082',
        'E083',
        'E084',
        'E085',
        'E086',
        'E087',
        'E088',
        'E089',
        'E090',
        'E091',
        'E092',
        'E093',
        'E094',
        'E095',
        'E096',
        'E097',
        'E098',
        'E099',
        'E100',
        'E101',
        'E102',
        'E103',
        'E104',
        'E105',
        'E106',
        'E107',
        'E108',
        'E109',
        'E110',
        'E111',
        'E112',
        'E113',
        'E114',
        'E115',
        'E116',
        'E117',
        'E118',
        'E119',
        'E120',
        'E121',
        'E122',
        'E123',
        'E124',
        'E125',
        'E126',
        'E127',
        'E128',
        'E129' ]
        
e_map = { 'E017' : 'IMR90 fetal lung fibroblasts',
          'E002' : 'ES-WA7',
          'E008' : 'H9',
          'E001' : 'ES-I3',
          'E015' : 'HUES6',
          'E014' : 'HUES48',
          'E016' : 'HUES64',
          'E003' : 'H1',
          'E024' : 'ES-UCSF4',
          'E020' : 'iPS-20b',
          'E019' : 'iPS-18',
          'E018' : 'iPS-15b',
          'E021' : 'iPS DF 6.9',
          'E022' : 'iPS DF 19.11',
          'E007' : 'H1 Derived Neuronal Progenitor Cultured', 
          'E009' : 'H9 Derived Neuronal Progenitor Cultured',
          'E010' : 'H9 Derived Neuron Cultured',
          'E013' : 'hESC Derived CD56+ Mesoderm Cultured',
          'E012' : 'hESC Derived CD56+ Ectoderm Cultured', 
          'E011' : 'hESC Derived CD184+ Endoderm Cultured',
          'E004' : 'H1 BMP4 Derived Mesendoderm Cultured',
          'E005' : 'H1 BMP4 Derived Trophoblast Cultured',
          'E006' : 'H1 Derived Mesenchymal Stem Cells',
          'E062' : 'Primary mononuclear cells from peripheral blood',
          'E034' : 'Primary T cells from peripheral blood',
          'E045' : 'Primary T cells effector/memory enriched from peripheral blood',
          'E033' : 'Primary T cells from cord blood',
          'E044' : 'Primary T regulatory cells from peripheral blood',
          'E043' : 'Primary T helper cells from peripheral blood',
          'E039' : 'Primary T helper naive cells from peripheral blood',
          'E041' : 'Primary T helper cells PMA-I stimulated',
          'E042' : 'Primary T helper 17 cells PMA-I stimulated',
          'E040' : 'Primary T helper memory cells from peripheral blood 1',
          'E037' : 'Primary T helper memory cells from peripheral blood 2',
          'E048' : 'Primary T CD8+ memory cells from peripheral blood',
          'E038' : 'Primary T helper naive cells from peripheral blood',
          'E047' : 'Primary T CD8+ naive cells from peripheral blood',
          'E029' : 'Primary monocytes from peripheral blood',
          'E031' : 'Primary B cells from cord blood',
          'E035' : 'Primary hematopoietic stem cells',
          'E051' : 'Primary hematopoietic stem cells G-CSF-mobilized Male',
          'E050' : 'Primary hematopoietic stem cells G-CSF-mobilized Female',
          'E036' : 'Primary hematopoietic stem cells short term culture',
          'E032' : 'Primary B cells from peripheral blood',
          'E046' : 'Primary Natural Killer cells from peripheral blood',
          'E030' : 'Primary neutrophils from peripheral blood',
          'E026' : 'Bone Marrow Derived Cultured Mesenchymal Stem Cells',
          'E049' : 'Mesenchymal Stem Cell Derived Chondrocyte Cultured',
          'E025' : 'Adipose Derived Mesenchymal Stem Cell Cultured',
          'E023' : 'Mesenchymal Stem Cell Derived Adipocyte Cultured',
          'E052' : 'Muscle Satellite Cultured',
          'E055' : 'Foreskin Fibroblast Primary Cells skin01',
          'E056' : 'Foreskin Fibroblast Primary Cells skin02', 
          'E059' : 'Foreskin Melanocyte Primary Cells skin01',
          'E061' : 'Foreskin Melanocyte Primary Cells skin03',
          'E057' : 'Foreskin Keratinocyte Primary Cells skin02',
          'E058' : 'Foreskin Keratinocyte Primary Cells skin03',
          'E028' : 'Breast variant Human Mammary Epithelial Cells (vHMEC)',
          'E027' : 'Breast Myoepithelial Primary Cells',
          'E054' : 'Ganglion Eminence derived primary cultured neurospheres',
          'E053' : 'Cortex derived primary cultured neurospheres',
          'E112' : 'Thymus',
          'E093' : 'Fetal Thymus',
          'E071' : 'Brain Hippocampus Middle',
          'E074' : 'Brain Substantia Nigra',
          'E068' : 'Brain Anterior Caudate',
          'E069' : 'Brain Cingulate Gyrus',
          'E072' : 'Brain Inferior Temporal Lobe',
          'E067' : 'Brain Angular Gyrus',
          'E073' : 'Brain_Dorsolateral_Prefrontal_Cortex',
          'E070' : 'Brain Germinal Matrix',
          'E082' : 'Fetal Brain Female',
          'E081' : 'Fetal Brain Male',
          'E063' : 'Adipose Nuclei',
          'E100' : 'Psoas Muscle',
          'E108' : 'Skeletal Muscle Female',
          'E107' : 'Skeletal Muscle Male',
          'E089' : 'Fetal Muscle Trunk',
          'E090' : 'Fetal Muscle Leg',
          'E083' : 'Fetal Heart',
          'E104' : 'Right Atrium',
          'E095' : 'Left Ventricle',
          'E105' : 'Right Ventricle',
          'E065' : 'Aorta',
          'E078' : 'Duodenum Smooth Muscle',
          'E076' : 'Colon Smooth Muscle',
          'E103' : 'Rectal Smooth Muscle',
          'E111' : 'Stomach Smooth Muscle',
          'E092' : 'Fetal Stomach',
          'E085' : 'Fetal Intestine Small',
          'E084' : 'Fetal Intestine Large',
          'E109' : 'Small Intestine',
          'E106' : 'Sigmoid Colon',
          'E075' : 'Colonic Mucosa',
          'E101' : 'Rectal Mucosa Donor 29',
          'E102' : 'Rectal Mucosa Donor 31',
          'E110' : 'Stomach Mucosa',
          'E077' : 'Duodenum Mucosa',
          'E079' : 'Esophagus',
          'E094' : 'Gastric',
          'E099' : 'Placenta Amnion',
          'E086' : 'Fetal Kidney',
          'E088' : 'Fetal Lung',
          'E097' : 'Ovary',
          'E087' : 'Pancreatic Islets',
          'E080' : 'Fetal Adrenal Gland',
          'E091' : 'Placenta',
          'E066' : 'Liver',
          'E098' : 'Pancreas',
          'E096' : 'Lung',
          'E113' : 'Spleen',
          'E114' : 'A549 EtOH 0.02pct Lung Carcinoma',
          'E115' : 'Dnd41 TCell Leukemia',
          'E116' : 'GM12878 Lymphoblastoid',
          'E117' : 'HeLa-S3 Cervical Carcinoma',
          'E118' : 'HepG2 Hepatocellular Carcinoma',
          'E119' : 'HMEC Mammary Epithelial Primary Cells',
          'E120' : 'HSMM Skeletal Muscle Myoblasts',
          'E121' : 'HSMM cell derived Skeletal Muscle Myotubes',
          'E122' : 'HUVEC Umbilical Vein Endothelial Primary Cells',
          'E123' : 'K562 Leukemia',
          'E124' : 'Monocytes-CD14+ RO01746 Primary Cells',
          'E125' : 'NH-A Astrocytes Primary Cells',
          'E126' : 'NHDF-Ad Adult Dermal Fibroblast Primary Cells',
          'E127' : 'NHEK-Epidermal Keratinocyte Primary Cells',
          'E128' : 'NHLF Lung Fibroblast Primary Cells',
          'E129' : 'Osteoblast Primary Cells' }
          
epigenome_metadata = {
    'type' : 'metadata',
    'vocabulary_set' : {
      'group' : {
        'vocabulary' : { 'Epigenome group' : [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19] },
        'terms' : {
          '1'  : ['IMR90',         '','#E41A1C'],
          '2'  : ['ESC',           '','#924965'],
          '3'  : ['iPSC',          '','#69608A'],
          '4'  : ['ES-derivative', '','#4178AE'],
          '5'  : ['Blood + T-cell','','#55A354'],
          '6'  : ['HSC + B-cell',  '','#678C69'],
          '7'  : ['Mesenchymal',   '','#B65C73'],
          '8'  : ['Myosatellite',  '','#E67326'],
          '9'  : ['Epithelial',    '','#FF9D0C'],
          '10' : ['Neurosphere',   '','#FFD924'],
          '11' : ['Thymus',        '','#DAB92E'],
          '12' : ['Brain',         '','#C5912B'],
          '13' : ['Adipose',       '','#AF5B39'],
          '14' : ['Muscle',        '','#C2655D'],
          '15' : ['Heart',         '','#D56F80'],
          '16' : ['Small Muscle',  '','#F182BC'],
          '17' : ['Digestive',     '','#C58DAA'],
          '18' : ['Other',         '','#999999'],
          '19' : ['ENCODE 2012',   '','#000000']
        },
      },
    }
  }

tissue_metadata = {
    'type' : 'metadata',
    'vocabulary_set' : {
      'group' : {
        'vocabulary' : { 'Epigenome group' : [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19] },
        'terms' : {
          '1'  : ['Adipose'        '','#E41A1C'],
          '2'  : ['Adrenal',       '','#924965'],
          '3'  : ['Blood',         '','#69608A'],
          '4'  : ['Bone',          '','#4178AE'],
          '5'  : ['Brain',         '','#55A354'],
          '6'  : ['Breast',        '','#678C69'],
          '7'  : ['Cervix',        '','#B65C73'],
          '8'  : ['Digestive',     '','#E67326'],
          '9'  : ['Endothelial',   '','#FF9D0C'],
          '10' : ['Epithelial',    '','#FFD924'],
          '11' : ['ESC',           '','#DAB92E'],
          '12' : ['ES-derived',    '','#C5912B'],
          '13' : ['Heart',         '','#AF5B39'],
          '14' : ['iPSC',          '','#C2655D'],
          '15' : ['Kidney',        '','#D56F80'],
          '16' : ['Liver',         '','#F182BC'],
          '17' : ['Lung',          '','#C58DAA'],
          '18' : ['Mesenchymal',   '','#999999'],
          '19' : ['Muscle',        '','#000000'],
          '20' : ['Neurosphere',   '','#000000'],
          '21' : ['Ovary',         '','#000000'],
          '22' : ['Pancreas',      '','#000000'],
          '23' : ['Placenta',      '','#000000'],
          '24' : ['Skin',          '','#000000'],
          '25' : ['Smooth Muscle', '','#000000'],
          '26' : ['Spleen',        '','#000000'],
          '27' : ['Thymus',        '','#000000']
        },
      },
    }
  }

#
# mapping of samples to epigenome tissue grouping used for epilogos
#



m_map = { 'E017' : 17,
          'E002' : 11,
          'E008' : 11,
          'E001' : 11,
          'E015' : 11,
          'E014' : 11,
          'E016' : 11,
          'E003' : 11,
          'E024' : 11,
          'E020' : 14,
          'E019' : 14,
          'E018' : 14,
          'E021' : 14,
          'E022' : 14,
          'E007' : 12, 
          'E009' : 12,
          'E010' : 12,
          'E013' : 12,
          'E012' : 12, 
          'E011' : 12,
          'E004' : 12,
          'E005' : 12,
          'E006' : 12,
          'E062' : 3,
          'E034' : 3,
          'E045' : 3,
          'E033' : 3,
          'E044' : 3,
          'E043' : 3,
          'E039' : 3,
          'E041' : 3,
          'E042' : 3,
          'E040' : 3,
          'E037' : 3,
          'E048' : 3,
          'E038' : 3,
          'E047' : 3,
          'E029' : 3,
          'E031' : 3,
          'E035' : 3,
          'E051' : 3,
          'E050' : 3,
          'E036' : 3,
          'E032' : 3,
          'E046' : 3,
          'E030' : 3,
          'E026' : 18,
          'E049' : 18,
          'E025' : 18,
          'E023' : 18,
          'E052' : 19,
          'E055' : 10,
          'E056' : 10, 
          'E059' : 10,
          'E061' : 10,
          'E057' : 10,
          'E058' : 10,
          'E028' : 10,
          'E027' : 10,
          'E054' : 20,
          'E053' : 20,
          'E112' : 27,
          'E093' : 27,
          'E071' : 5,
          'E074' : 5,
          'E068' : 5,
          'E069' : 5,
          'E072' : 5,
          'E067' : 5,
          'E073' : 5,
          'E070' : 5,
          'E082' : 5,
          'E081' : 5,
          'E063' : 1,
          'E100' : 19,
          'E108' : 19,
          'E107' : 19,
          'E089' : 19,
          'E090' : 19,
          'E083' : 13,
          'E104' : 13,
          'E095' : 13,
          'E105' : 13,
          'E065' : 13,
          'E078' : 25,
          'E076' : 25,
          'E103' : 25,
          'E111' : 25,
          'E092' : 8,
          'E085' : 8,
          'E084' : 8,
          'E109' : 8,
          'E106' : 8,
          'E075' : 8,
          'E101' : 8,
          'E102' : 8,
          'E110' : 8,
          'E077' : 8,
          'E079' : 8,
          'E094' : 8,
          'E099' : 23,
          'E086' : 15,
          'E088' : 17,
          'E097' : 21,
          'E087' : 22,
          'E080' : 2,
          'E091' : 23,
          'E066' : 16,
          'E098' : 22,
          'E096' : 17,
          'E113' : 26,
          'E114' : 17,
          'E115' : 3,
          'E116' : 3,
          'E117' : 7,
          'E118' : 16,
          'E119' : 6,
          'E120' : 19,
          'E121' : 19,
          'E122' : 9,
          'E123' : 3,
          'E124' : 3,
          'E125' : 5,
          'E126' : 10,
          'E127' : 10,
          'E128' : 17,
          'E129' : 4 }
          
# 9	195	E109-H3K4me1.broadPeak.gz	UW	H3K4me1	E109 Small Intestine	Small Intestine	E109 Small Intestine	NA	E109	http://egg2.wustl.edu/roadmap/data/byFileType/peaks/consolidated/broadPeak/E109-H3K4me1.broadPeak.gz

# CREATE TABLE sample (
#        dataset_id INTEGER REFERENCES dataset(dataset_id),
#        sample_order INTEGER,
#        file,
#        lab,
#        datatype,
#        cell,
#        tissue,
#        shortcell,
#        individual,
#        acc,
#        url);

dataset_id = '11'
sample_order = 1
lab = 'UW'
individual = 'NA'
url = 'NA'

for mark in marks:
  for sample in all:
    datatype = mark.split('_')[1]
    file = os.path.join(files_dir, '%s_%s.bed' % (sample, mark))
    if not os.path.exists(file):
      raise SystemError("Could not find per-sample, per-mark file\n")
    cell = "%s %s" % (sample, e_map[sample])
    try:
        tissue = tissue_metadata['vocabulary_set']['group']['terms'][str(m_map[sample])][0]
    except KeyError:
        print "!"
        print m_map[sample]
        print tissue_metadata['vocabulary_set']['group']['terms'][str(m_map[sample])]
    
    shortcell = cell
    acc = sample
    sys.stdout.write("%s\n" % ('\t'.join([dataset_id,
                                          str(sample_order),
                                          file,
                                          lab,
                                          datatype,
                                          cell,
                                          tissue,
                                          shortcell,
                                          individual,
                                          acc,
                                          url])))
    sample_order += 1
